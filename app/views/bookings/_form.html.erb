<%= form_for @booking, remote: true do |f| %>

  <%= hidden_field(:booking, :facility_type_id, :value => params[:facility_type_id]) %>
  <%= hidden_field(:booking, :user_id, :value => current_user.id) %>
  <%= hidden_field(:booking, :booking_date, :value => Date.today.strftime("%Y-%m-%d")) %>


  <% @facilities = Facility.where(facility_type_id: params[:facility_type_id]).to_a %>

  <% @facilities.each do |fac| %>
    <div class="">
      <%= radio_button(:booking, :facility_id, fac.id) %>
      <%= label_tag(:facility_id_facility, (fac.facility_type.name + fac.number.to_s)) %>
    </div>
    <div class="">
      <% @fac_type = FacilityType.find(params[:facility_type_id]) %>
      <% @fac_open = @fac_type.opens_at.to_i %>
      <% @fac_close = @fac_type.closes_at.to_i %>
      <% (@fac_open...@fac_close).step(@fac_type.session_length * 3600).each do |timestamp| %>
      <% timestamp = Time.at(timestamp).strftime("%H:%M:%S") %>
      <%= radio_button(:booking, :start_at, timestamp) %>
      <%= label_tag(:facility_id_facility, timestamp) %>
      <% end %>
    </div>

  <% end %>

<br>
<br>
  <div class="actions">
    <%= f.submit %>
  </div>
<% end %>
